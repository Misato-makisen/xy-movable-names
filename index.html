<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>スマホ対応の名前移動</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
    }
    
    #backgroundTable {
      position: relative;
      width: 100%;
      margin-bottom: 20px;
      background-color: #e6f0ff;
      padding: 10px;
      border-radius: 8px;
      box-sizing: border-box; /* パディングを含めた幅計算 */
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      table-layout: fixed;
      box-sizing: border-box; /* パディングを含めた幅計算 */
    }
    
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      width: 25%;
    }
    
    th {
      background-color: #d9eaff;
      font-weight: bold;
    }
    
    td {
      background-color: #f4f9ff;
    }
    
    .draggable {
      width: 100px;
      height: 50px;
      background-color: #ffd700;
      text-align: center;
      line-height: 50px;
      border: 1px solid #999;
      border-radius: 5px;
      position: absolute;
      cursor: move;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
      box-sizing: border-box; /* パディングを含めた幅計算 */
    }

    /* スマホ向けスタイル */
    @media screen and (max-width: 600px) {
      #backgroundTable {
        max-width: 100%; /* 最大幅を設定 */
        padding: 5px; /* スマホ画面ではパディングを小さく */
      }

      table {
        font-size: 90%; /* スマホではフォントサイズを少し小さく */
      }

      .draggable {
        width: 80px; /* ドラッグ要素も小さく */
        height: 40px;
        line-height: 40px;
      }
    }
  </style>
</head>
<body>

<!-- 背景に時間表を表示 -->
<div id="backgroundTable">
  <table>
    <tr>
      <th>帰社予時刻</th>
      <th></th>
      <th>帰社予時刻</th>
      <th></th>
    </tr>
    <tr>
      <td>9:30</td><td></td><td>14:00</td><td></td>
    </tr>
    <tr>
      <td>10:00</td><td></td><td>14:30</td><td></td>
    </tr>
    <tr>
      <td>10:30</td><td></td><td>15:00</td><td></td>
    </tr>
    <tr>
      <td>11:00</td><td></td><td>15:30</td><td></td>
    </tr>
    <tr>
      <td>11:30</td><td></td><td>16:00</td><td></td>
    </tr>
    <tr>
      <td>12:00</td><td></td><td>16:30</td><td></td>
    </tr>
    <tr>
      <td>12:30</td><td></td><td>17:00</td><td></td>
    </tr>
    <tr>
      <td>13:00</td><td></td><td>18:00以降</td><td class="highlight-red-text"></td>
    </tr>
    <tr>
      <td>13:30</td><td></td><td class="highlight-red large-text">直帰</td><td></td>
    </tr>
  </table>
</div>

<div id="names">
  <div class="draggable" id="person1">勝村</div>
  <div class="draggable" id="person2">佐藤</div>
  <div class="draggable" id="person3">船田孝</div>
  <div class="draggable" id="person4">滝澤</div>
  <div class="draggable" id="person5">雨宮</div>
  <div class="draggable" id="person2">小林</div>
</div>

<script>
  // ドラッグ可能な要素を取得
  const draggables = document.querySelectorAll('.draggable');

  draggables.forEach(draggable => {
    // マウスイベントを登録
    draggable.addEventListener('mousedown', onMouseDown);
    
    // タッチイベントを登録
    draggable.addEventListener('touchstart', onTouchStart);
    
    // ページ読み込み時に保存された位置を取得
    const savedPosition = JSON.parse(localStorage.getItem(draggable.id));
    if (savedPosition) {
      draggable.style.left = `${savedPosition.x}px`;
      draggable.style.top = `${savedPosition.y}px`;
    }
  });

  // マウスでドラッグする処理
  function onMouseDown(event) {
    const target = event.target;
    let shiftX = event.clientX - target.getBoundingClientRect().left;
    let shiftY = event.clientY - target.getBoundingClientRect().top;

    target.style.position = 'absolute';
    target.style.zIndex = 1000;
    document.body.append(target);

    moveAt(event.pageX, event.pageY);

    function moveAt(pageX, pageY) {
      target.style.left = pageX - shiftX + 'px';
      target.style.top = pageY - shiftY + 'px';
    }

    function onMouseMove(event) {
      moveAt(event.pageX, event.pageY);
    }

    document.addEventListener('mousemove', onMouseMove);

    target.onmouseup = function() {
      document.removeEventListener('mousemove', onMouseMove);
      target.onmouseup = null;

      // 座標を保存
      const position = { x: target.offsetLeft, y: target.offsetTop };
      localStorage.setItem(target.id, JSON.stringify(position));
    };
  }

  // タッチ操作でドラッグする処理
  function onTouchStart(event) {
    const target = event.target;
    const touch = event.touches[0];
    let shiftX = touch.clientX - target.getBoundingClientRect().left;
    let shiftY = touch.clientY - target.getBoundingClientRect().top;

    target.style.position = 'absolute';
    target.style.zIndex = 1000;
    document.body.append(target);

    moveAt(touch.pageX, touch.pageY);

    function moveAt(pageX, pageY) {
      target.style.left = pageX - shiftX + 'px';
      target.style.top = pageY - shiftY + 'px';
    }

    function onTouchMove(event) {
      const touch = event.touches[0];
      moveAt(touch.pageX, touch.pageY);
    }

    document.addEventListener('touchmove', onTouchMove);

    target.ontouchend = function() {
      document.removeEventListener('touchmove', onTouchMove);
      target.ontouchend = null;

      // 座標を保存
      const position = { x: target.offsetLeft, y: target.offsetTop };
      localStorage.setItem(target.id, JSON.stringify(position));
    };
  }

  draggables.forEach(draggable => {
    draggable.ondragstart = () => false;
  });
</script>

</body>
</html>
